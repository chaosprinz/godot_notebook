# Part 2 - Top-down player movement

- [Part 2 - Top-down player movement](#part-2---top-down-player-movement)
  - [Adding the world](#adding-the-world)
  - [Adding player-movement](#adding-player-movement)
    - [Add a script to the player](#add-a-script-to-the-player)
    - [Scipting player-movement](#scipting-player-movement)
      - [Goals](#goals)
      - [Code](#code)
      - [Explanation](#explanation)
        - [Creating public property for speed](#creating-public-property-for-speed)
        - [Define the `handleInput()`-Function](#define-the-handleinput-function)
        - [The `_physics_process()`-Signal](#the-_physics_process-signal)

> Video: [Top-down player movement](https://www.youtube.com/watch?v=HdkW8UThwuQ&list=PLMQtM2GgbPEVuTgD4Ln17ombTg6EahSLr&index=2&pp=iAQB)

## Adding the world

- Create a new scene (menu -> scene -> new scene) from 2dScene.
- Rename and save it
- Add an instance of the player-object by draggin it from the file-browser to the root-node

## Adding player-movement

### Add a script to the player

- Go back to the player scene
- On the root-object, right-click and choose "Attach script"

### Scipting player-movement

#### Goals
We have 3 goals to achieve with our script:

1. Get movement direction from input
2. Set Velocity to movement directiont * speed
3. Move the player

#### Code 
```GDScript
extends CharacterBody2D

@export var speed: int = 35

func handleInput() -> void:
    var moveDirection = Input.get_vector("ui_left", "ui_right", "ui_up", "ui_down")
    velocity = moveDirection * speed

func _physics_process(delta: float) -> void:
    handleInput()
    move_and_slide()
```

#### Explanation

As we have a [[CharacterBody2d]] we inherit from its class.

##### Creating public property for speed
We create a speed-property, using the `@export`-decorator. This way the Variable is avaiable in the Scene´s inspector.

##### Define the `handleInput()`-Function

In the `handleInput()`-Function we use the `get_vector()`-method of the `Input`-Singleton. It take four actions for the positive and negative X and Y axes and returns a Vector2d.  

We store this Vector as our `moveDirection`.  

Now that we have a direction and speed, we can set the `velocity`-property to `moveDirection * speed`
 
> Sources:


##### The `_physics_process()`-Signal

`physics_process()` gets called every physics-frame with the time since the last frame as argument (`delta` in seconds)

Its the right place to call our `handleInput()`-Function to set the velocity.

To actually move our Player we call the `move_and_slide()`-method. 
Sliding is a common collision-response for moving a player 
along walls in a top-down game.

> Sources:  
> - [Input](https://docs.godotengine.org/en/stable/classes/class_input.html)-class
> - Inputs´ [get_vector()](https://docs.godotengine.org/en/stable/classes/class_input.html#class-input-method-get-vector)-Method
> Also see: [Using InputEvents](https://docs.godotengine.org/en/stable/tutorials/inputs/inputevent.html)
> - [_physics_process()](https://docs.godotengine.org/en/stable/classes/class_mainloop.html#class-mainloop-private-method-physics-process)
> - [move_and_slide()](https://docs.godotengine.org/en/stable/tutorials/physics/physics_introduction.html#move-and-slide)
> 
> Also see [Idle and Physics-processing](https://docs.godotengine.org/en/stable/tutorials/scripting/idle_and_physics_processing.html)


[//begin]: # "Autogenerated link references for markdown compatibility"
[CharacterBody2d]: CharacterBody2d "CharacterBody2d"
[//end]: # "Autogenerated link references"
